"use strict";var App;App=angular.module("app",["ngCookies","ngResource","ngRoute","app.controllers","app.directives","app.filters","app.services","partials","audioPlayer"]),App.config(["$routeProvider","$locationProvider",function(e,t){return e.when("/test",{templateUrl:"/partials/test.html"}).when("/zik",{templateUrl:"/partials/zik.html"}).otherwise({redirectTo:"/zik"}),t.html5Mode(!1)}]),angular.module("audioPlayer",[]).directive("audioPlayer",["$rootScope","$log","$interpolate","$timeout","throttle",function(e,t,n,r,a){var o;return o=function(e,t,n,r){return this instanceof o?(r=r||{},n=n||[],angular.extend(this,{_element:e,_audioTag:e[0],_scope:t,_playlist:n,name:r.name||"audioplayer",playing:!1,currentTrack:0,tracks:n.length,volume:e[0].volume,muted:e[0].muted,duration:e[0].duration,currentTime:e[0].currentTime,buffered:e[0].buffered,played:e[0].played,seekable:e[0].seekable,formatDuration:"",formatTime:"",loadPercent:0,position:e[0].currentTime}),void(this._unbindListeners=this._bindListeners(t))):new o(e,t,n,r)},o.prototype={load:function(e,t){var n;"boolean"==typeof e?(t=e,e=null):"object"==typeof e&&(this._clearAudioList(),this._addAudioList(e)),this._scope.$emit(this.name+":load",t),this._audioTag.load(),t&&(n=this,n._element.bind("canplaythrough",function(){n.play(),n._element.unbind("canplaythrough")}))},play:function(e){return this._playlist.length>e?(this.currentTrack=e+1,this.load(this._playlist[e],!0)):(!this.currentTrack&&this._audioTag.readyState&&this.currentTrack++,void this._audioTag.play())},playPause:function(e){"number"==typeof e&&e+1!==this.currentTrack?this.play(e):this.playing?this.pause():this.play()},pause:function(){this._audioTag.pause()},toggleMute:function(){this.muted=this._audioTag.muted=!this._audioTag.muted},next:function(e){var t,n;t=this,t.currentTrack&&t.currentTrack<t.tracks&&(n=e||t.playing,t.pause(),r(function(){t._clearAudioList(),t._addAudioList(t._playlist[t.currentTrack]),t.load(n),t.currentTrack++}))},prev:function(e){var t,n;t=this,t.currentTrack&&t.currentTrack-1&&(n=e||t.playing,t.pause(),r(function(){t._clearAudioList(),t._addAudioList(t._playlist[t.currentTrack-2]),t.load(n),t.currentTrack--}))},_addAudioList:function(e){var t,r;t=this,angular.isArray(e)?angular.forEach(e,function(e){var r;r=angular.element(n('<source src="{{ src }}" type="{{ type }}" media="{{ media }}">')(e)),t._element.append(r)}):angular.isObject(e)&&(r=angular.element(n('<source src="{{ src }}" type="{{ type }}" media="{{ media }}">')(e)),t._element.append(r))},_clearAudioList:function(){this._element.contents().remove()},_formatTime:function(e){var t,n,r,a,o;return n=parseInt(e/3600,10)%24,r=parseInt(e/60,10)%60,o=parseInt(e%60,10),a=void 0,t=(10>r?"0"+r:r)+":"+(10>o?"0"+o:o),a=n>0?(10>n?"0"+n:n)+":"+t:t},_bindListeners:function(e){var t,n,r,o,i,u,l;return r=this,t=this._element,l=a(1e3,!1,function(){e.$apply(function(){r.currentTime=r.position=r._audioTag.currentTime,r.formatTime=r._formatTime(r.currentTime)})}),i=function(t){return function(){e.$apply(function(){r.playing=t}),t?e.$emit(r.name+":play",r.currentTrack-1):e.$emit(r.name+":pause")}},o=function(){e.$apply(function(){r.currentTrack||r.currentTrack++,r.duration=r._audioTag.duration,r.formatDuration=r._formatTime(r.duration),r.loadPercent=parseInt(r._audioTag.buffered.end(r._audioTag.buffered.length-1)/r.duration*100,10)})},n=function(){r.next(!0)},u=function(){r._audioTag.buffered.length&&e.$apply(function(){r.loadPercent=parseInt(r._audioTag.buffered.end(r._audioTag.buffered.length-1)/r.duration*100,10)})},t.bind("playing",i(!0)),t.bind("pause",i(!1)),t.bind("ended",n),t.bind("timeupdate",l),t.bind("loadedmetadata",o),t.bind("progress",u),function(){t.unbind("playing"),t.unbind("pause"),t.unbind("ended"),t.unbind("timeupdate"),t.unbind("loadedmetadata"),t.unbind("progress")}}},{scope:{exposedPlayer:"=playerControl",playlist:"=playlist"},link:function(e,n){var a,i,u,l;return l=function(n,a){var o,i,u,l;if(l=e.exposedPlayer,o=void 0,u=null,void 0===n)return void 0!==a?(l.pause(),t.debug("playlist was deleted from scope, pausing and returning")):t.error("if you use playlist attribute, you need $scope.playlistVariable = []; in your code");if(l.currentTrack){for(o=a?a[l.currentTrack-1]:-1,i=0;i<n.length;){if(angular.equals(n[i],o)){u=i;break}i++}null!==u?(l.currentTrack=u+1,l.tracks=n.length):(l.pause(),n.length&&r(function(){l._clearAudioList(),l._addAudioList(n[0]),l.load(),l.tracks=n.length}))}else n.length&&(l._clearAudioList(),l._addAudioList(n[0]),l.load(),l.tracks=n.length)},"AUDIO"!==n[0].tagName?t.error("audioPlayer directive works only when attached to an <audio> type tag"):(a=[],u=n.find("source"),i=e.playlist||[],angular.forEach(u,function(e){a.push({src:e.src,type:e.type,media:e.media})}),a.length&&i.unshift(a),e.exposedPlayer=new o(n,e,i),e.$emit(e.exposedPlayer.name+":ready",e.exposedPlayer),e.$watch("playlist",l,!0),void e.$on("$destroy",function(){e.exposedPlayer._unbindListeners()}))}}}]),angular.module("audioPlayer").factory("throttle",["$timeout",function(e){return function(t,n,r,a){var o,i,u;return i=void 0,o=0,"boolean"!=typeof n&&(a=r,r=n,n=void 0),u=function(){var u,l,c,s,d;d=this,c=+new Date-o,u=arguments_,s=function(){o=+new Date,r.apply(d,u)},l=function(){i=void 0},a&&!i&&s(),i&&e.cancel(i),void 0===a&&c>t?s():n!==!0&&(i=e(a?l:s,void 0===a?t-c:t))}}}]),angular.module("app.controllers",[]).controller("AppCtrl",["$scope","$location","$resource","$rootScope",function(e,t){return e.$location=t,e.$watch("$location.path()",function(t){return e.activeNavId=t||"/"}),e.getClass=function(t){return e.activeNavId.substring(0,t.length)===t?"active":""}}]).controller("MusicNavList",["$scope","myaudio","filemanager",function(e,t){return e.selectedElement={name:"plop",datapath:"/home/gdestrem/test.ogg"},e.list=[{name:"plop",datapath:"/home/gdestrem/test.ogg"},{name:"plop2",datapath:"something"},{name:"plop3",datapath:"something"}],e.onElementListClick=function(n){return e.selectedElement=n,console.log(e.selectedElement),console.log(t),t.play(n.datapath),t.read(n.datapath)}}]).controller("TodoCtrl",["$scope",function(e){return e.todos=[{text:"learn angular",done:!0},{text:"build an angular app",done:!1}],e.addTodo=function(){return e.todos.push({text:e.todoText,done:!1}),e.todoText=""},e.remaining=function(){var t;return t=0,angular.forEach(e.todos,function(e){return t+=e.done?0:1}),t},e.archive=function(){var t;return t=e.todos,e.todos=[],angular.forEach(t,function(t){return t.done?void 0:e.todos.push(t)})}}]);var DataStore,createDocumentStore,createRelationalStore,createSimpleStore;DataStore="undefined"!=typeof exports&&null!==exports&&exports||(this.DataStore={}),DataStore.create=function(e){switch(e){case"simple":return createSimpleStore();case"relational":return createRelationalStore();case"document":return createDocumentStore();default:return void 0}},createSimpleStore=function(){return{get:function(e){return JSON.parse(localStorage.getItem(JSON.stringify(e)))},set:function(e,t){return localStorage.setItem(JSON.stringify(e),JSON.stringify(t))},"delete":function(e){return localStorage.removeItem(JSON.stringify(e))},count:function(){return localStorage.length},clear:function(){return localStorage.clear()}}},createRelationalStore=function(){var e,t;return e=openDatabase("nwsqldb","1.0","embedded sql database",268435456),t={run:function(t,n){return e.transaction(function(e){return e.executeSql(t,[],function(e,t){var r;return"function"==typeof n?n(function(){var e,n,a;for(a=[],r=e=0,n=t.rows.length;n>=0?n>e:e>n;r=n>=0?++e:--e)a.push(t.rows.item(r));return a}()):void 0})})}}},createDocumentStore=function(){var e,t,n,r;try{return e=require("nedb"),t=require("nw.gui").App.dataPath+"/nedb",r={collection:function(t){return new e({filename:"/"+t,autoload:!0})}}}catch(a){return n=a,console.error("MODULE_NOT_FOUND"===n.code?"NeDB not found. Try `npm install nedb --save` inside of `/app/assets`.":n)}},angular.module("app.directives",["app.services"]).directive("appVersion",["version",function(e){return function(t,n){return n.text(e)}}]),angular.module("app.filters",[]).filter("interpolate",["version",function(e){return function(t){return String(t).replace(/\%VERSION\%/gm,e)}}]);var services;services=angular.module("app.services",[]),services.factory("myaudio",["$document",function(e){var t;return t=e[0].createElement("audio"),{audioElement:t,play:function(e){t.src=e,t.play()},read:function(){var e;return e=require("fs"),console.log(e)}}}]),services.factory("filemanager",function(){var e;return e=require("readdirp"),{walk:function(){var t;return t=[],e({root:"/",fileFilter:["*.mp3","*.avi"]}).on("data",function(e){return console.log(e),t.push(e)}).on("end",function(e){return console.log(t),console.log(e)})}}}),services.factory("version",function(){return"0.1"});